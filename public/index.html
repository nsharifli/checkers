<html>
	<head>
		<script src="/js/libs/easeljs-0.8.2.min.js"></script>
		<script src="/js/client.js"></script>
		<script>    
		
			

			function init() {


				function initBoard(stage) {
					var virtualBoard = [];
					for (row = 0; row < 8; row++) {
						each_row = [];
						for (col = 0; col < 8; col++){
							cell = [];
							for (obj = 0; obj < 2; obj++){
								cell.push(null);
							}
							each_row.push(cell);
						}
						virtualBoard.push(each_row);
						
					}
					var squares = [];
					for (row = 0; row < 8; row++) {
						for (col = 0; col < 8; col++) {

							square = new createjs.Shape();
							(col + row) % 2 == 0 ? square.graphics.beginFill("grey").drawRect(0, 0, 50, 50) : 
							square.graphics.beginFill("black").drawRect(0, 0, 50, 50);
							square.x = 200 + col * 50;
							square.y = 100 + row * 50;
							square.boardX = col;
							square.boardY = row;
							squares.push(square);
							virtualBoard[row][col][0] = square;
							stage.addChild(square);
						}
					}
					return virtualBoard;
				}
			

				function availableMoves(virtualBoard, piece) {
					var moves = [];

					if (piece.boardX > 0 && piece.boardY < 7){
						var left = virtualBoard[piece.boardY+1][piece.boardX - 1];
						if (left[1] == null) {
							moves.push(left[0]);
						}
					}

					if (piece.boardX < 7 && piece.boardY < 7){
						var right = virtualBoard[piece.boardY+1][piece.boardX + 1];
						if (right[1] == null) {
							moves.push(right[0]);
						}
					}

				

					return moves;
				}

				function distance(x1, y1, x2, y2) {
					var distance = Math.sqrt((x1 - x2) ** 2 + (y1 - y2) ** 2);
					return distance;
				}





				function initPieces(stage, virtualBoard) {
					var white_pieces = [];
					var red_pieces = [];
					for (row = 0; row < 3; row++) {
						for (col = 0; col < 8; col++){
							if ((row + col) % 2 == 1) {
								white_piece = new createjs.Shape();
								white_piece.graphics.beginFill("white").drawCircle(0,0,20);
								white_piece.x = virtualBoard[row][col][0].x + 25;
								white_piece.y = virtualBoard[row][col][0].y + 25;
								white_pieces.push(white_piece);
								virtualBoard[row][col][1] = white_piece;
								white_piece.boardX = col;
								white_piece.boardY = row;
								stage.addChild(white_piece);

								white_piece.on("pressmove", function(evt){
									var piece = evt.currentTarget;

									piece.x = evt.stageX;
									piece.y = evt.stageY;

									var moves = availableMoves(virtualBoard, piece);

									moves.forEach(function(square){
										square.alpha = 0.7;
									});
								})

								white_piece.on("pressup", function(evt) {
									var piece = evt.currentTarget;
									var moves = availableMoves(virtualBoard, piece);
									var initial_square = virtualBoard[piece.boardY][piece.boardX];

									moves.forEach(function(square){
										square.alpha = 1;
									})

									var closestSquare = moves.find(function(square){
										return ((square.x < evt.stageX) && (evt.stageX < square.x + 50)) && 
										((square.y < evt.stageY) && (evt.stageY < square.y + 50));
										})

									if (closestSquare == null){
										piece.x = initial_square[0].x + 25;
										piece.y = initial_square[0].y + 25;	
									}

									else {
										piece.x = closestSquare.x + 25;
										piece.y = closestSquare.y + 25;
										virtualBoard[piece.boardY][piece.boardX][1] = null;
										piece.boardX = closestSquare.boardX;
										piece.boardY = closestSquare.boardY;
										virtualBoard[closestSquare.boardY][closestSquare.boardX][1] = piece;


									}


								})




							}
						}
					}
				}

										

								// else if ( [5, 6, 7].indexOf(row) != -1 && (row + col) % 2 == 1) {
								// 	a = a + 1
								// 	red_piece = new createjs.Shape();
								// 	red_piece.graphics.beginFill("red").drawCircle(0,0,20);
								// 	red_piece.x = square.x + 25;
								// 	red_piece.y = square.y + 25;
								// 	red_pieces.push(red_piece);
								// 	virtualBoard[row][col][1] = red_piece;
								// 	red_piece.boardX = col;
								// 	red_piece.boardY = row;
								// 	stage.addChild(red_piece);
								// }

				var stage = new createjs.Stage("demoCanvas");

				var virtualBoard = initBoard(stage);

				initPieces(stage, virtualBoard);

				createjs.Ticker.on("tick", function tick(event) {  
    				stage.update(event);
				});
				
				createjs.Ticker.setFPS(20);
				

				


			}



			
	
    	</script>
	</head>

	<body onload="init();">

		<canvas id="demoCanvas" width="800" height="600"></canvas>


	</body>
</html>